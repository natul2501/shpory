<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
	<title>Diary</title>
	<link rel="icon" type="image/png" href="media/icon.png">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
	<meta name="robots" content="noindex, nofollow"> <!-- —Ä–æ–±–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ—é –≤—ñ–¥ –ø–æ—à—É–∫–æ–≤–∏—Ö –±–æ—Ç—ñ–≤ -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
	<!------------------------------ HEADER----------------------------------->
	<header id="header">
		<h2 id="headerHeader">TAGEBUCH</h2>
		<!--<div id="descr">–û–ø–∏—Å</div>-->
		<div id="menuMob">
            <button id="newArticleMenuButton" onclick="showmenu()" title="Menu">
                <i class="fa-solid fa-bars" id="MBSymbol"></i>
            </button>
        </div>
	</header>
	<div id="panelInstruments">
		<a class="panelInstrumentsButton" href="/diary/public/flysquirrel-diary/ua">üá∫üá¶</a>
		<a class="panelInstrumentsButton" href="/diary/public/flysquirrel-diary/de">üá©üá™</a>
		<% if(user) { %>
		<a class="panelInstrumentsButton" href="/diary/public/flysquirrel-diary/logout">Abmelden</a>
		<% } %>
		<% if(!user) { %>
			<a class="panelInstrumentsButton" href="/diary/public/flysquirrel-diary/login-de">Anmelden</a>
		<% } %>
	</div>
	<!------------------------------ MENUS----------------------------------->
	<div id="menu">
		<div id="panelInstrumentsMob">
			<div class="PIButtContainer">
				<a class="PIButt" href="/diary/public/flysquirrel-diary/ua">üá∫üá¶</a>
				<a class="PIButt" href="/diary/public/flysquirrel-diary/de">üá©üá™</a>
			</div>
			<div class="PIButtContainer">
				<% if(user) { %>
					<a class="PIButt" href="/diary/public/flysquirrel-diary/logout">Abmelden</a>
				<% } %>
				<% if(!user) { %>
					<a class="PIButt" href="/diary/public/flysquirrel-diary/login-de">Anmelden</a>
				<% } %>
			</div>
		</div>
		<ul>
			<li><a href="/" class="menuLink">Hauptseite</a></li>
			<li><a href="diaries-de.html" class="menuLink">Diaries</a></li>
			<li><a href="/diary/public/robert-diary/" class="menuLink">Artikel √úbersicht</a></li>
			<li><a href="/diary/public/robert-diary/galerie" class="menuLink">Galerie</a></li>
			<% if(author) author.forEach(d => {
				if (d === 'robert-diary') { %>
			<li><a href="/diary/public/newArticleRob-de.html" class="menuLink">Neuer Artikel</a></li>
			<% }}) %>
		</ul>
		<div id="menuTagsMob">
			<center><div id="menuTagsMobHeader">Tags</div></center>
			<% tags.forEach(tag => { %>
				<div class="tagLinkContainer">
					<a href="/diary/public/<%- authorLink %>/searchResults/<%- tag.name %>"
						class="tagLink"
						style="font-size:<%=16+(tag.count*0.5)%>px;">
							<%- tag.name %>
					</a>
				</div>&nbsp; 
				<% }) %>
		</div>
		<div id="menuCommentsHeader">Letzte Kommentare:</div>
				<% lastComments.forEach(comment => { %>
					<div class="lastCommContainer">
						<b><a href="<%- comment.commentLink %>" class="commentDateMenu">
							<%- comment.date %> <%- comment.author %>
						</a></b><br><div class="commentTextMenu"><%- comment.commentText %></div><br>
					</div>
				<% }) %>
	</div>
	<!------------------------------ CONTENT-------------------------------->
	<div id="searchByDate" >
		<details><summary style="margin: 3px 0px 3px 15px;">Suchleiste...</summary>
			<label for="datePicker">üìÖ Zeigen Artikel vor :</label>
			<input type="date" id="datePicker"><br>
			<label for="inputSearch">Oder suchzeichenfolge eingeben: </label>
			<input type="text" id="inputSearch"><br>
			<button onclick="startDateSearch()" id="startDateSearch">üîç Suchen</button>
		</details>
    </div>
	<div class="container" id="articlesContainer">
		<!-- –°—Ç–∞—Ç—Ç—ñ –±—É–¥—É—Ç—å –¥–æ–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏—Å—å —Å—é–¥–∏ -->
	  </div>
	<div id="loading" style="text-align:center; padding: 1em; display:none;">Loading...</div>

	<div id="menuTags">
		<center><b>Tags</b></center>
		<% tags.forEach(tag => { %>
			<a href="/diary/public/<%- authorLink %>/searchResults/<%- tag.name %>"
				class="tagLink"
				style="font-size:<%=14+(tag.count*0.5)%>px;">
					<%- tag.name %>
				</a>&nbsp; 
			<% }) %>
	</div>
	<footer>Durch die Nutzung dieser Website erkl√§ren Sie sich mit den <a href="/diary/public/flysquirrel-diary/TermsOfUse-de" id="footerLink">Nutzungsbedingungen</a> einverstanden</footer>
	<script>
/*------ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∑–Ω–∞—á–æ–∫ –º–µ–Ω—é –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö ------*/
		function showmenu(){
			let menu = document.getElementById('menu');
			if(menu.style.display == 'block'){
				menu.style.display = 'none';
			} else {
				menu.style.display = 'block';
			}
		}
/*--- –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Å—Ç–∏–ª—ñ –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ—ó / –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ—ó –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—ó -*/
		function applyStyles() {
			const existing = document.getElementById("dynamic-styles");
			if (existing) existing.remove(); // –≤–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∏–ª—å
			const link = document.createElement("link");
			link.rel = "stylesheet";
			link.type = "text/css";
			link.id = "dynamic-styles";
			if (window.innerHeight > window.innerWidth) {
				link.href = "/diary/public/css/diaryRobstyleMob.css";
			} else {
				link.href = "/diary/public/css/diaryRobstyle.css";
			}
			document.head.appendChild(link);
		}
		applyStyles();
		window.addEventListener("resize", applyStyles);
/*---- –¥–æ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–µ–π –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—á—É–≤–∞–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -*/
		let offset = 0;
		const limit = 20;
		let loading = false;
		let endReached = false;
		let searchByDate = false;
		let selectedDate = "";
		let inputString = '';
		// –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å—Ç–∞—Ç—Ç—ñ –ø—Ä–∏ –ø–æ—á–∞—Ç–∫–æ–≤–æ–º—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
		window.addEventListener("load", () => {
			loadArticles(); 
		});
		// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç—Ü—ñ
		window.addEventListener('scroll', () => {
		if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 200) {
			loadArticles();
		}
		});
/*-------- –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–∞—Ç–µ–π –¥–ª—è –¥–æ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ------------*/
		async function loadArticles() {
			if (loading || endReached) return;
			loading = true;
			document.getElementById('loading').style.display = 'block';
			try {
				let newArticles;
				// –Ø–∫—â–æ –ø–æ—à—É–∫ –∑–∞ –¥–∞—Ç–æ—é
				if (searchByDate) {
					const res = await fetch(`/diary/public/robert-diary/searchByDate/${selectedDate}?offset=${offset}`);
					if (!res.ok) throw new Error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è");
					newArticles = await res.json();
					if (newArticles.length === 0) {
						endReached = true;
						searchByDate = false;
						document.getElementById('loading').innerText = 'Es gibt keine mehr Artikel.';
						return;
					}
				} else {
					inputString = document.getElementById('inputSearch').value;
					const res = await fetch(`/diary/public/robert-diary/api/articles?offset=${offset}&inputString=${inputString}`);
					newArticles = await res.json();
					if (newArticles.length === 0) {
						endReached = true;
						document.getElementById('loading').innerText = 'Es gibt keine mehr Artikel.';
						return;
					}
				}
				offset += limit;
				renderArticles(newArticles);
			} catch (err) {
				console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:", err);
			} finally {
				loading = false;
				document.getElementById('loading').style.display = 'none';
			}
		}
/*-------- —Ä–µ–Ω–¥–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —ñ–∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –Ω–∞ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ ------------*/
		function renderArticles(articles) {
		const container = document.getElementById('articlesContainer');
		articles.forEach(article => {
			if(article.date){
				const html = `
				<a href="/diary/public/robert-diary/${article.id}" title="${article.title}" style="text-decoration: none;">
					<div class="event">
					<div style="float: right;"><i class="${article.articleSymbol}"></i></div>
					<time class="time">${article.date}</time>
					<div class="about">${article.thema}</div>
					<p class="tags">${article.tags}</p>
					</div>
				</a>`;
				container.insertAdjacentHTML('beforeend', html);
			} else {
				const html = 
				`<div class="event">
					<div class="about">${article.thema}</div>
				</div>`
				container.insertAdjacentHTML('beforeend', html);
			}
			
		});
		}
/*-------- —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ—à—É–∫—É –∑–∞ –¥–∞—Ç–æ—é ------------*/
		function startDateSearch() {
			selectedDate = document.getElementById("datePicker").value;
			inputString = document.getElementById('inputSearch').value;
			if (selectedDate) searchByDate = true;
			offset = 0; // –°–∫–∏–¥–∞—î–º–æ offset –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ—à—É–∫—É
			endReached = false; // –°–∫–∏–¥–∞—î–º–æ flag, —â–æ–± –∑–Ω–æ–≤—É –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–∞—Ç—Ç—ñ
			// –û—á–∏—â–∞—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–∞—Ç–µ–π –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –Ω–æ–≤–∏—Ö
			document.getElementById('articlesContainer').innerHTML = '';
			loadArticles(); // –í–∏–∫–ª–∏–∫–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–µ–π
		}
	</script>
</body>
</html>