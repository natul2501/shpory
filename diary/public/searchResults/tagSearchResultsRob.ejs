<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
	<title>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É –ø–æ —Ç–µ–≥—É</title>
	<link rel="icon" type="image/png" href="media/icon.png">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
	<meta name="robots" content="noindex, nofollow"> <!-- —Ä–æ–±–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ—é –≤—ñ–¥ –ø–æ—à—É–∫–æ–≤–∏—Ö –±–æ—Ç—ñ–≤ -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
	<!------------------------------ HEADER----------------------------------->
	<header id="header">
		<h2 id="headerHeader">–©–û–î–ï–ù–ù–ò–ö</h2>
		<!--<div id="descr">–û–ø–∏—Å</div>-->
		<div id="menuMob">
            <button id="newArticleMenuButton" onclick="showmenu()" title="–ú–µ–Ω—é">
                <i class="fa-solid fa-bars" id="MBSymbol"></i>
            </button>
        </div>
	</header>
	<div id="panelInstruments">
		<a class="panelInstrumentsButton" href="/diary/public/flysquirrel-diary/ua">üá∫üá¶</a>
		<a class="panelInstrumentsButton" href="/diary/public/flysquirrel-diary/de">üá©üá™</a>
		<% if(user) { %>
			<a class="panelInstrumentsButton" href="/diary/public/flysquirrel-diary/logout">–í–∏–π—Ç–∏ —ñ–∑ –∞–∫–∞—É–Ω—Ç–∞</a>
		<% } %>
		<% if(!user) { %>
			<a class="panelInstrumentsButton" href="/diary/public/flysquirrel-diary/login-de">–£–≤—ñ–π—Ç–∏ –≤ –∞–∫–∞—É–Ω—Ç</a>
		<% } %>
	</div>
	<!------------------------------ MENUS----------------------------------->
	<div id="menu">
		<div id="panelInstrumentsMob">
			<div class="PIButtContainer">
				<a class="PIButt" href="/diary/public/flysquirrel-diary/ua">üá∫üá¶</a>
				<a class="PIButt" href="/diary/public/flysquirrel-diary/de">üá©üá™</a>
			</div>
			<div class="PIButtContainer">
				<% if(user) { %>
					<a class="PIButt" href="/diary/public/flysquirrel-diary/logout">–í–∏–π—Ç–∏ —ñ–∑ –∞–∫–∞—É–Ω—Ç–∞</a>
				<% } %>
				<% if(!user) { %>
					<a class="PIButt" href="/diary/public/flysquirrel-diary/login-de">–£–≤—ñ–π—Ç–∏ –≤ –∞–∫–∞—É–Ω—Ç</a>
				<% } %>
			</div>
		</div>
		<ul>
				<li><a href="/" class="menuLink">–ì–æ–ª–æ–≤–Ω–∞</a></li>
				<li><a href="diaries-de.html" class="menuLink">–©–æ–¥–µ–Ω–Ω–∏–∫–∏</a></li>
				<li><a href="/diary/public/robert-diary/" class="menuLink">–°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å—ñ–≤</a></li>
				<% if (author) author.forEach(d => {
					if (d === 'robert-diary') { %>
				<li><a href="/diary/public/newArticleRob-de.html" class="menuLink">–ù–æ–≤–∏–π –∑–∞–ø–∏—Å</a></li>
				<% }}) %>
		</ul>
	</div>
	<!------------------------------ CONTENT----------------------------------->
	<div id="searchByDate" >
		<details><summary style="margin: 3px 0px 3px 15px;">–ü–∞–Ω–µ–ª—å –ø–æ—à—É–∫—É...</summary>
			<label for="datePicker">üìÖ –ü–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞—Ç—Ç—ñ –¥–æ :</label>
			<input type="date" id="datePicker"><br>
			<label for="inputSearch">–ê–±–æ –≤–≤–µ–¥—ñ—Ç—å —Å—Ç—Ä–æ–∫—É –ø–æ—à—É–∫—É: </label>
			<input type="text" id="inputSearch"><br>
			<button onclick="startDateSearch()" id="startDateSearch">üîç –ü–æ—à—É–∫</button>
		</details>
		<center>–í—Å—ñ —Å—Ç–∞—Ç—Ç—ñ –∑ —Ç–µ–≥–æ–º <b id="tagname"><%- tagname %></b></center>
    </div>
	<div class="container" id="articlesContainer">
		<!-- –°—Ç–∞—Ç—Ç—ñ –±—É–¥—É—Ç—å –¥–æ–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏—Å—å —Å—é–¥–∏ -->
	</div>
	<div id="loading" style="text-align:center; padding: 1em; display:none;">Loading...</div>
	<div id="menuTags">
		<center><b>–¢–µ–≥–∏</b></center>
		<% tags.forEach(tag => { %>
			<a href="/diary/public/<%- authorLink %>/searchResults/<%- tag.name %>"
				class="tagLink"
				style="font-size:<%=14+(tag.count*0.5)%>px;">
					<%- tag.name %>
				</a>&nbsp; 
			<% }) %>
	</div>
	<footer>–ó–Ω–∞—Ö–æ–¥—è—á–∏—Å—å –Ω–∞ –¥–∞–Ω–æ–º—É –≤–µ–±-—Å–∞–π—Ç—ñ –≤–∏ –ø–æ–≥–æ–¥–∂—É—î—Ç–µ—Å—è –∑ <a href="/diary/public/flysquirrel-diary/TermsOfUse" id="footerLink">–£–º–æ–≤–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è</a></footer>
	<script>
		function showmenu(){
			let menu = document.getElementById('menu');
			if(menu.style.display == 'block'){
				menu.style.display = 'none';
			} else {
				menu.style.display = 'block';
			}
		}
		function applyStyles() {
			const existing = document.getElementById("dynamic-styles");
			if (existing) existing.remove(); // –≤–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∏–ª—å
			const link = document.createElement("link");
			link.rel = "stylesheet";
			link.type = "text/css";
			link.id = "dynamic-styles";
			if (window.innerHeight > window.innerWidth) {
				link.href = "/diary/public/css/diaryRobstyleMob.css";
			} else {
				link.href = "/diary/public/css/diaryRobstyle.css";
			}
			document.head.appendChild(link);
		}
		applyStyles();// –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
		window.addEventListener("resize", applyStyles);// –ü–µ—Ä–µ-–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É –≤—ñ–∫–Ω–∞
/*---- –¥–æ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–µ–π –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—á—É–≤–∞–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -*/
let offset = 0;
		const limit = 20;
		let loading = false;
		let endReached = false;
		let searchByDate = false;
		let selectedDate = "";
		let inputString = '';
		// –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å—Ç–∞—Ç—Ç—ñ –ø—Ä–∏ –ø–æ—á–∞—Ç–∫–æ–≤–æ–º—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
		window.addEventListener("load", () => {
			loadArticles(); 
		});
		// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç—Ü—ñ
		window.addEventListener('scroll', () => {
		if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 200) {
			loadArticles();
		}
		});
/*-------- –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–∞—Ç–µ–π –¥–ª—è –¥–æ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ------------*/
		async function loadArticles() {
			if (loading || endReached) return;
			loading = true;
			document.getElementById('loading').style.display = 'block';
			try {
				let newArticles;
				// –Ø–∫—â–æ –ø–æ—à—É–∫ –∑–∞ –¥–∞—Ç–æ—é
				if (searchByDate) {
					const tagname = document.getElementById('tagname').textContent;
					const res = await fetch(`/diary/public/robert-diary/searchTagByDate/${selectedDate}?offset=${offset}&tagname=${tagname}`);
					if (!res.ok) throw new Error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è");
					newArticles = await res.json();
					if (newArticles.length === 0) {
						endReached = true;
						searchByDate = false;
						document.getElementById('loading').innerText = 'Es gibt keine mehr Artikel.';
						return;
					}
				} else {
					const tagname = document.getElementById('tagname').textContent;
					inputString = document.getElementById('inputSearch').value;
					const res = await fetch(`/diary/public/robert-diary/api/articles?offset=${offset}&tagname=${tagname}&inputString=${inputString}`);
					newArticles = await res.json();
					if (newArticles.length === 0) {
						endReached = true;
						document.getElementById('loading').innerText = 'Es gibt keine mehr Artikel.';
						return;
					}
				}
				offset += limit;
				renderArticles(newArticles);
			} catch (err) {
				console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:", err);
			} finally {
				loading = false;
				document.getElementById('loading').style.display = 'none';
			}
		}
/*-------- —Ä–µ–Ω–¥–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —ñ–∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –Ω–∞ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ ------------*/
		function renderArticles(articles) {
		const container = document.getElementById('articlesContainer');
		articles.forEach(article => {
			if(article.date){
				const html = `
				<a href="/diary/public/robert-diary/${article.id}" title="${article.title}" style="text-decoration: none;">
					<div class="event">
					<div style="float: right;"><i class="${article.articleSymbol}"></i></div>
					<time class="time">${article.date}</time>
					<div class="about">${article.thema}</div>
					<p class="tags">${article.tags}</p>
					</div>
				</a>`;
				container.insertAdjacentHTML('beforeend', html);
			} else {
				const html = 
				`<div class="event">
					<div class="about">${article.thema}</div>
				</div>`
				container.insertAdjacentHTML('beforeend', html);
			}
		});
		}
/*-------- —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ—à—É–∫—É –∑–∞ –¥–∞—Ç–æ—é ------------*/
		function startDateSearch() {
			selectedDate = document.getElementById("datePicker").value;
			inputString = document.getElementById('inputSearch').value;
			if (selectedDate) searchByDate = true;
			offset = 0; // –°–∫–∏–¥–∞—î–º–æ offset –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ—à—É–∫—É
			endReached = false; // –°–∫–∏–¥–∞—î–º–æ flag, —â–æ–± –∑–Ω–æ–≤—É –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–∞—Ç—Ç—ñ
			// –û—á–∏—â–∞—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–∞—Ç–µ–π –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –Ω–æ–≤–∏—Ö
			document.getElementById('articlesContainer').innerHTML = '';
			loadArticles(); // –í–∏–∫–ª–∏–∫–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–µ–π
		}
	</script>
</body>
</html>